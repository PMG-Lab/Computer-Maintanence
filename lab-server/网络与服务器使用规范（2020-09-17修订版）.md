# 网络与服务器使用规范（2020-09-17修订版）

## Part 1 实验室高性能计算集群（HPC）简介

集群拓扑结构：

用途|节点名称|配置信息
:---:|:--:|:---:
登陆节点|master|**不作计算用途**
CPU计算节点|amd01|24核+32G
同上|pan01|128核+1536G
同上|node02|44核+384G
同上|pan02|80核+1024G
GPU计算节点|gpu01|20核+128G+3*Nvidia显卡

## Part 2 PBS简单教程

### 2.1 PBS简介

作为集群系统软件的重要组成部分，集群作业管理系统可以统一管理和调度集群的软硬件资源，保证用户作业公平合理地共享集群资源，提高系统利用率和吞吐率。常用的集群作业管理系统：PBS（Portable Batch System），LSF 和 SLURM，其中PBS主要包括openPBS, PBS Pro和Torque三种分支。本机采用了PBS系统Torque版本。[PBS使用指南](http://web.snplife.com/oa/server/2019-10-13/wuzhou.pdf)

### 2.2 PBS简单使用示例

1. 查看资源占用情况

    命令：`pestat`

    节点状态

    * excl ：所有CPU资源已被占用；
    * busy ：CPU已接近满负荷运行；
    * free ：全部或部分CPU空闲；
    * offl ：管理员手动指定离线状态。

    如需要获取精确的节点核心占用情况，需使用`qstat -f`或`pbsnodes`命令获取具体节点具体核心的占用。 

2. 准备任务shell脚本

    脚本开头添加PBS相关参数，指定完PBS参数后再添加相关shell脚本代码。

    ```
    #PBS -N jobname
    #PBS -l nodes=gpu01:ppn=20
    #PBS -l mem=100G
    #PBS -o output.log
    #PBS -e error.log
    #PBS -q default

    # 要执行的shell脚本代码
    java -Xmx10g -jar ./kggseq.jar 
    ```

    参数解读

    * jobname：指定提交的作业名
    * nodes：指定任务运行节点（如pan01、pan02等）
    * ppn：申请的CPU核数
    * mem：申请的内存大小（暂统一以G为单位）
    * output.log：存放输出日志文件路径（自行指定）
    * error.log：存放错误日志文件路径（自行指定）
    * default：提交至默认目标队列（无需修改）

3. 提交任务

    qsub +上述准备好的脚本，如`qsub qsub_kggseq.sh`

4. 任务状态查询

    `qstat`查询任务状态，任务状态为“R”代表正在运行，“H”代表等待可用资源，“C”代表异常终止

    `qstat -f 任务号`查询任务详情

## Part 3 普通用户规范

1. 软件安装：
    * 可执行程序、python/R包安装，存放到自己目录，如需共享，可存放至/sdb1/tools; 
    * 编译安装软件时需要相关系统依赖库时请联系**龙奇涵**安装。
2. 任务提交：PBS提交系统，合理使用资源。PBS问题联系**龙奇涵**。
3. 系统故障，联系**朱正**。
4. 项目数据存放，文件共享：联系**易国荣老师**。
5. 磁盘空间限制8TB，超过后将被限制登陆，联系**薛超**解决。
6. 临时目录路径：/public1/tmp，30天后将被清除。
7. 网络使用问题，联系**薛超**解决。